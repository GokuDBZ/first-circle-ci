
version: 2.1 

executors:
  ruby_executor:
    docker:
      - image: circleci/ruby:2.5.1

commands:
  install_gems_and_checkout:
    parameters:
      my_message:
        type: "string"
        default: "hello world"
    steps:
      - checkout
      - run: "ruby -v" 
      - run: "gem install bundler"
      - run: "bundle install"
      - run: echo "<< parameters.my_message  >>"
  

jobs: 
  build: 
    executor: ruby_executor
    steps: 
      - install_gems_and_checkout:
          my_message: "this is build"
      
  test: 
    docker:
      - image: circleci/ruby:2.5.1
    steps:
      - install_gems_and_checkout:
          my_message: "this is test"
      - run: rspec test.rb

workflows: 
  version: 2 
  build-test:  
    jobs:     
      - build:
          filters: 
            branches:
              only:
                - master
      - test:
          requires:
            - build
          filters:  
            branches:
              only:
                - master
    